<!DOCTYPE html>
<html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Entregable 2</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.6.3/rxjs.umd.min.js"></script>
    </head>

    <body>
        <input type="text">
        <span id="spanData"></span>

        <script>
            const { Observable, pipe } = rxjs
            const { map, tap } = rxjs.operators

            function espejarInput() {
                return new Observable(suscriber => {
                    function ateEventInput() {
                        let dato = document.querySelector('input').value

                        if (dato == 'error') {
                            suscriber.error('Error de entrada')
                        }
                        else if (dato == 'complete') {
                            suscriber.complete()
                        }
                        else {
                            suscriber.next(dato)
                        }
                    }
                    document.querySelector('input').addEventListener('input', ateEventInput)

                    return () => {
                        document.querySelector('input').removeEventListener('input', ateEventInput)
                        document.querySelector('input').disabled = true
                        document.getElementById("spanData").innerHTML = ''
                        console.warn('Observable Input return')
                    }
                })
            }
            let suscriptorEspejarInput = espejarInput().pipe(
                tap(dato => console.log('pipe:', dato)),
                map(dato => dato.split('')),
                map(array => {
                    array = array.reverse()
                    return array
                }),
                map(array => array.join('')),
                tap(dato => console.log('pispe:', dato)),

            )
                .subscribe(
                    dato => {
                        document.getElementById("spanData").innerHTML = dato
                    }, 
                    error => console.error(error),
                    () => console.warn('Observable Input complete ')
                )

            setTimeout(() => {
                console.warn('Observable Input desuscripci√≥n ')
                suscriptorEspejarInput.unsubscribe()
            }, 30000)

        </script>
    </body>
</html>